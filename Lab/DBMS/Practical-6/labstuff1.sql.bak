/*
CURSOR
	
	Two types:
	1. Implicit
		Automatically declared
		SQL statement is executed
		Not under USER's control
		(NOTE: SQL Cursor is the most recently used cursor)
		Parameter: SQL%ROWCOUNT
			You will know how many rows are returned by the cursor.
	2. Explicit
		Program defines it and returns more than one row of data.
		Prorammers Control: Declare, Execute [Open, Fetch, Close]
		

*/

ALTER TABLE PERSON
	ADD(STATUS CHAR(5));
	
DESC PERSON;

SET SERVEROUTPUT ON

--Implicit Cursor
BEGIN 
	UPDATE PERSON
		SET STATUS = 'TRUE';
	DBMS_OUTPUT.PUT_LINE('Rows Affected := '||SQL%ROWCOUNT);
END;
/

--Declaring Exlicit CURSOR
DECLARE 
	CURSOR C_PERSON_DETAILS IS	
		SELECT FNAME, LNAME, STATUS	
			FROM PERSON
			WHERE BIRTHDATE <'01-JAN-2005';
	PERSON_REC C_PERSON_DETAILS%ROWTYPE;
	
	BEGIN 
		OPEN C_PERSON_DETAILS;
		LOOP	
			FETCH C_PERSON_DETAILS INTO PERSON_REC;
				EXIT WHEN C_PERSON_DETAILS%NOTFOUND;
			DBMS_OUTPUT.PUT_LINE(PERSON_REC.FNAME||' '||PERSON_REC.LNAME||' '||PERSON_REC.STATUS);
		END LOOP;
		CLOSE C_PERSON_DETAILS;
		DBMS_OUTPUT.PUT_LINE(CHR(10));
		DBMS_OUTPUT.PUT_LINE('CURSOR PROCESSED');
	END;
/

DECLARE 
	CURSOR C_PERSON_DETAILS IS	
		SELECT FNAME, LNAME, STATUS	
			FROM PERSON
			WHERE BIRTHDATE <'01-JAN-2005';
	PERSON_REC C_PERSON_DETAILS%ROWTYPE;
	
	BEGIN 
		OPEN C_PERSON_DETAILS;
		LOOP	
			FETCH C_PERSON_DETAILS INTO PERSON_REC;
				EXIT WHEN C_PERSON_DETAILS%NOTFOUND;
			DBMS_OUTPUT.PUT_LINE(PERSON_REC.FNAME||' '||PERSON_REC.LNAME||' '||PERSON_REC.STATUS);
		END LOOP;
		CLOSE C_PERSON_DETAILS;
		DBMS_OUTPUT.PUT_LINE(CHR(10));
		DBMS_OUTPUT.PUT_LINE('CURSOR PROCESSED');
		
	EXCEPTION
		WHEN OTHERS THEN
			IF C_PERSON_DETAILS%ISOPEN THEN	
				DBMS_OUTPUT.PUT_LINE('CLOSING THE CURSOR...');
				CLOSE C_PERSON_DETAILS;
			END IF;
	END;
/

DECLARE 
	CURSOR C_PERSON_DETAILS IS	
		SELECT FNAME, LNAME, GENDER	
			FROM PERSON;
	
	BEGIN 
		FOR PERSON_REC IN C_PERSON_DETAILS
			LOOP	
				FETCH C_PERSON_DETAILS INTO PERSON_REC;
					EXIT WHEN C_PERSON_DETAILS%NOTFOUND;
				DBMS_OUTPUT.PUT_LINE(PERSON_REC.FNAME||' '||PERSON_REC.LNAME||' '||PERSON_REC.GENDER);
			END LOOP;
		DBMS_OUTPUT.PUT_LINE(CHR(10));
		DBMS_OUTPUT.PUT_LINE('CURSOR PROCESSED');
		
	END;
/
--ERROR


	


